# MoodTune 项目运行指南

## 快速开始

### 步骤 1: 安装 Python 依赖

打开终端（PowerShell 或 CMD），进入项目目录，运行：

```bash
pip install -r requirements.txt
```

### 步骤 2: 启动 Flask 后端服务器

**方法一：使用 Python 命令（推荐）**

```bash
python server.py
```

服务器将在 `http://localhost:5000` 启动，你会看到类似以下的输出：
```
启动 MoodTune Flask 服务器...
API 端点: http://localhost:5000/generate-summary
健康检查: http://localhost:5000/health
 * Running on http://127.0.0.1:5000
```

**方法二：使用启动脚本（Windows）**

双击运行 `start_backend.bat` 文件（如果已创建）

**重要提示：** 
- 保持这个终端窗口打开，不要关闭
- 后端服务器必须运行，前端才能调用 AI 功能

### 步骤 3: 启动前端服务器

**打开一个新的终端窗口**（保持后端服务器运行），然后：

**方法一：使用 Python**

```bash
python -m http.server 8000
```

**方法二：使用 Node.js**

```bash
npx http-server -p 8000
```

**方法三：使用 VS Code Live Server**

1. 在 VS Code 中安装 "Live Server" 扩展
2. 右键点击 `index.html` 文件
3. 选择 "Open with Live Server"

### 步骤 4: 访问应用

打开浏览器，访问：
```
http://localhost:8000
```

## 使用功能

1. **查看数据可视化**
   - 页面加载后会自动显示收听时间线和情感雷达图
   - 数据来自 `emotions.json` 文件

2. **生成 AI 推荐**
   - 点击页面上的 "🤖 生成心情摘要" 按钮
   - 等待几秒钟，AI 会生成个性化的心情摘要和推荐流派
   - 结果会显示在页面上

## 常见问题

### 问题 1: 端口已被占用

如果遇到端口被占用错误：

**后端端口 5000 被占用：**
- 修改 `server.py` 最后一行的端口号，例如：`app.run(debug=True, port=5001)`
- 同时修改 `app.js` 中的 `API_BASE_URL` 为 `http://localhost:5001`

**前端端口 8000 被占用：**
- 使用其他端口，例如：`python -m http.server 8001`
- 然后访问 `http://localhost:8001`

### 问题 2: 无法连接到后端服务器

如果点击"生成心情摘要"按钮时出现错误：

1. **检查后端是否运行**
   - 确认 Flask 服务器正在运行
   - 在浏览器中访问 `http://localhost:5000/health` 检查服务器状态

2. **检查端口是否正确**
   - 确认后端运行在端口 5000
   - 确认 `app.js` 中的 `API_BASE_URL` 设置为 `http://localhost:5000`

3. **检查 CORS 设置**
   - 确认 `server.py` 中已启用 CORS：`CORS(app)`

### 问题 3: 数据未加载

如果图表没有显示：

1. **检查 emotions.json 文件**
   - 确认文件存在于项目根目录
   - 确认文件格式正确（有效的 JSON）

2. **检查浏览器控制台**
   - 按 F12 打开开发者工具
   - 查看 Console 标签页中的错误信息

3. **使用本地服务器**
   - 不要直接双击打开 HTML 文件
   - 必须通过 HTTP 服务器访问（http://localhost:8000）

## 测试 API

如果你想测试后端 API 是否正常工作：

```bash
python test_api.py
```

这会测试健康检查端点和生成摘要端点。

## 项目结构

```
MoodTune/
├── index.html          # 前端页面
├── style.css           # 样式文件
├── app.js              # 前端逻辑
├── emotions.json       # 音乐数据
├── server.py           # Flask 后端
├── requirements.txt    # Python 依赖
├── test_api.py         # API 测试脚本
└── README.md           # 项目说明
```

## 停止服务器

- **停止后端服务器**：在运行 `server.py` 的终端窗口中按 `Ctrl + C`
- **停止前端服务器**：在运行前端服务器的终端窗口中按 `Ctrl + C`

## 下一步

- 修改 `emotions.json` 文件添加你自己的音乐数据
- 自定义 `server.py` 中的 AI 推荐逻辑
- 修改 `style.css` 调整界面样式
- 集成真实的 OpenAI API（替换 `simulate_openai_api` 函数）

祝你使用愉快！🎵

